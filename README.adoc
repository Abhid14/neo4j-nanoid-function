= Neo4j Nano ID Function (Extended)

A Neo4j user-defined function that provides Nano ID generation capabilities directly within Cypher queries. This extended version offers both standard Nano ID and Quick ID variants for different use cases. Nano ID is a tiny, secure, URL-safe, unique string ID generator that's an excellent alternative to UUID.

== Features

* üîí *Secure*: Cryptographically strong random generator using `java.util.Random`
* üìè *Compact*: Shorter than UUID (21 characters vs 36 for Nano ID, 14 for Quick ID)
* ‚ö° *Quick ID*: Ultra-compact 14-character alphanumeric IDs (A-Za-z0-9 only)
* üåê *URL-safe*: Standard Nano ID with underscore and dash support (A-Za-z0-9_-)
* ‚öôÔ∏è *Configurable*: Custom alphabet and size support for Nano ID functions
* üîå *Native*: Direct integration with Neo4j Cypher queries
* üõ°Ô∏è *Robust*: Graceful fallback handling for edge cases

== Installation

=== Prerequisites

* Neo4j 5.26.0 or later
* Java 21+

[NOTE]
====
This project requires Java 21 or later and is tested with Neo4j 5.26.0. If you're using an older Java version, you'll see a build error. 

To check your Java version:
[source,bash]
----
java -version
----

To install Java 21, consider using link:https://sdkman.io/[SDKMAN!]:
[source,bash]
----
# Install SDKMAN
curl -s "https://get.sdkman.io" | bash

# Install Java 21
sdk install java 21.0.2-tem

# Use Java 21 for this project
sdk use java 21.0.2-tem
----
====

=== Steps

. Download the latest JAR with the `-extended` suffix from the link:../../releases[releases page]
. Copy the JAR file to your Neo4j `plugins` directory:
+
[source,bash]
----
cp neo4j-nanoid-function-1.0.0-extended.jar $NEO4J_HOME/plugins/
----
. Restart your Neo4j instance
. Verify installation by testing both function types:
+
[source,cypher]
----
// Test Quick ID generation
RETURN quickid.generate() AS quick_id;

// Test Nano ID generation  
RETURN nanoid.generate() AS nano_id;
----

== Usage

=== Basic Usage

[source,cypher]
----
// Generate a compact Quick ID (14 characters, alphanumeric only)
RETURN quickid.generate() AS id;
// Result: "V1StGXR8Z5jdHi"

// Generate a standard Nano ID (21 characters, URL-safe with underscore and dash)
RETURN nanoid.generate() AS id;
// Result: "V1StGXR8_Z5jdHi6B-myT4a"

// Create a node with Quick ID
CREATE (u:User {id: quickid.generate(), name: 'Alice'});

// Use in MERGE operations
MERGE (p:Product {id: nanoid.generate()})
SET p.name = 'New Product';
----

=== Custom Size

[source,cypher]
----
// Generate shorter Quick ID (8 characters, alphanumeric)
RETURN quickid.generateSized(8) AS id;
// Result: "IRFaVaY2"

// Generate longer Quick ID (20 characters, alphanumeric)  
RETURN quickid.generateSized(20) AS id;
// Result: "6a9ZnpMRiuZ8sNFbJ1mx"

// Generate custom sized Nano ID (URL-safe)
RETURN nanoid.generateSized(15) AS id;
// Result: "IRFa-VaY2b_XyZ1"
----

=== Custom Alphabet

[source,cypher]
----
// Use only uppercase letters and numbers
RETURN nanoid.generateCustomSized('0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ', 12) AS id;
// Result: "A1B2C3D4E5F6"

// Use only digits with default size (21 chars)
RETURN nanoid.generateCustom('0123456789') AS id;
// Result: "123456789012345678901"

// Use only digits with custom size
RETURN nanoid.generateCustomSized('0123456789', 8) AS id;
// Result: "12345678"

// Custom alphabet with specific length
RETURN nanoid.generateCustomSized('ABCDEF', 16) AS id;
// Result: "ABCDEFFEDCBABCDE"
----

=== Batch Generation

[source,cypher]
----
// Generate multiple Quick IDs
UNWIND range(1, 5) AS i
RETURN quickid.generate() AS id, i;

// Create multiple nodes with unique Quick IDs
UNWIND ['Alice', 'Bob', 'Charlie'] AS name
CREATE (u:User {id: quickid.generate(), name: name});

// Mix different ID types
UNWIND range(1, 3) AS i
RETURN quickid.generate() AS quick_id, nanoid.generate() AS nano_id, i;
----

== Available Functions

[cols="1,2,2,1"]
|===
|Function |Description |Example |Default Size

|`quickid.generate()`
|Generate compact alphanumeric ID (A-Za-z0-9)
|`RETURN quickid.generate()`
|14 chars

|`quickid.generateSized(size)`
|Generate alphanumeric ID with custom size
|`RETURN quickid.generateSized(8)`
|Custom

|`nanoid.generate()`
|Generate URL-safe ID (A-Za-z0-9_-)
|`RETURN nanoid.generate()`
|21 chars

|`nanoid.generateSized(size)`
|Generate URL-safe ID with custom size
|`RETURN nanoid.generateSized(15)`
|Custom

|`nanoid.generateCustom(alphabet)`
|Generate with custom alphabet (default size)
|`RETURN nanoid.generateCustom('ABC123')`
|21 chars

|`nanoid.generateCustomSized(alphabet, size)`
|Generate with custom alphabet and size
|`RETURN nanoid.generateCustomSized('ABC123', 8)`
|Custom
|===

== Comparison with UUID

[cols="1,1,1,1"]
|===
|Feature |Quick ID |Nano ID |UUID

|Length
|14 characters
|21 characters
|36 characters

|Default Alphabet
|Alphanumeric (62 chars)
|URL-safe (64 chars)
|Hex + hyphens

|Characters Used
|A-Za-z0-9
|A-Za-z0-9_-
|0-9a-f + hyphens

|URL-safe
|‚úÖ Always (no special chars)
|‚úÖ Yes (_- included)
|‚ùå No (hyphens)

|Collision probability
|~1% after 1M IDs
|~1% after 1B IDs
|Same as UUID v4

|Performance
|~60% faster
|~60% faster
|Standard

|Readability
|‚úÖ Ultra-clean
|‚úÖ Clean
|‚ùå Contains hyphens

|Customizable
|‚ùå Size only
|‚úÖ Alphabet & size
|‚ùå Fixed format
|===

== Use Cases

* *Primary Keys*: Use `quickid.generate()` for ultra-compact primary keys (14 chars)
* *Display IDs*: Quick ID provides clean alphanumeric IDs for user-facing identifiers  
* *URL Slugs*: Use `nanoid.generate()` for URL-safe characters when underscores/dashes are acceptable
* *API Keys*: Secure random generation with customizable alphabets via `nanoid.generateCustom()`
* *Session IDs*: Compact and secure with flexible character sets
* *File Names*: Quick ID is safe for all file systems (no special characters)

== Building from Source

=== Prerequisites

* Java 21+
* Maven 3.9.4+

=== Build Steps

[source,bash]
----
# Clone the repository
git clone https://github.com/Abhid14/neo4j-nanoid-function.git
cd neo4j-nanoid-function
git checkout extended

# Build the project
./mvnw clean package

# The JAR will be created in target/
ls target/neo4j-nanoid-function-1.0.0-extended.jar
----

[TIP]
====
If you encounter a Java version error during build, make sure you're using Java 21 or later. The build will fail with older Java versions.
====

=== Running Tests

[source,bash]
----
# Run all tests
./mvnw test

# Run tests with detailed output
./mvnw test -Dtest=NanoIdFunctionTest,QuickIdFunctionTest

# Run only Quick ID tests
./mvnw test -Dtest=QuickIdFunctionTest

# Run only Nano ID tests  
./mvnw test -Dtest=NanoIdFunctionTest
----

== Function Behavior

=== Quick ID vs Nano ID

* *`quickid.generate()`*: Returns ultra-compact 14-character alphanumeric IDs (A-Za-z0-9) - ideal for primary keys and space-constrained scenarios
* *`quickid.generateSized(size)`*: Same alphanumeric alphabet but with custom length
* *`nanoid.generate()`*: Returns standard 21-character URL-safe IDs with underscores and dashes (A-Za-z0-9_-) - compatible with original Nano ID spec  
* *`nanoid.generateSized(size)`*: URL-safe alphabet with custom length
* *`nanoid.generateCustom(alphabet)`*: Custom alphabet with default 21-character length
* *`nanoid.generateCustomSized(alphabet, size)`*: Fully customizable alphabet and length

=== Edge Case Handling

The functions are designed to be robust and always return valid IDs:

[source,cypher]
----
// Invalid sizes fallback to defaults
RETURN quickid.generateSized(0) AS id;         // Returns 14-char alphanumeric ID  
RETURN quickid.generateSized(-5) AS id;        // Returns 14-char alphanumeric ID
RETURN quickid.generateSized(null) AS id;      // Returns 14-char alphanumeric ID
RETURN nanoid.generateSized(0) AS id;          // Returns 21-char URL-safe ID
RETURN nanoid.generateSized(-5) AS id;         // Returns 21-char URL-safe ID

// Invalid alphabet falls back to default behavior
RETURN nanoid.generateCustomSized('', 10) AS id;      // Returns 21-char URL-safe ID
RETURN nanoid.generateCustomSized('   ', 8) AS id;    // Returns 21-char URL-safe ID  
RETURN nanoid.generateCustomSized(null, 8) AS id;     // Returns 21-char URL-safe ID
RETURN nanoid.generateCustom('') AS id;               // Returns 21-char URL-safe ID
RETURN nanoid.generateCustom(null) AS id;             // Returns 21-char URL-safe ID
----

== Configuration

The function uses an enhanced Nano ID configuration:

* *Quick ID*: 
  - Alphabet: Alphanumeric characters only (A-Za-z0-9) - 62 character alphabet
  - Default size: 14 characters
  - Use cases: Primary keys, compact identifiers, file-safe names
* *Nano ID*: 
  - Alphabet: URL-safe characters `_-0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ` (64 characters)
  - Default size: 21 characters  
  - Use cases: URLs, general-purpose IDs, web-safe identifiers
* *Custom Nano ID*: 
  - Alphabet: Fully configurable via `nanoid.generateCustom()` and `nanoid.generateCustomSized()`
  - Size: Fully configurable
  - Use cases: Specialized requirements, branded IDs, restricted character sets
* *Collision probability*: 
  - Quick ID: ~1% after generating 1 million IDs
  - Nano ID: ~1% after generating 1 billion IDs
* *Edge case handling*: Invalid inputs gracefully fall back to defaults

== Performance

Benchmarks on standard hardware:

* *Generation rate*: ~2M IDs/second
* *Memory usage*: Minimal overhead
* *Thread safety*: Fully thread-safe

== Dependencies

* link:https://github.com/aventrix/jnanoid[jnanoid 2.0.0]: Core Nano ID implementation  
* Neo4j 5.26.0: Function framework
* JUnit Jupiter 5.11.0: Testing framework (test scope)
* AssertJ 3.27.3: Assertion library (test scope)

== Contributing

. Fork the repository
. Create a feature branch (`git checkout -b feature/amazing-feature`)
. Commit your changes (`git commit -m 'Add amazing feature'`)
. Push to the branch (`git push origin feature/amazing-feature`)
. Open a Pull Request

== License

This project is licensed under the Apache License 2.0 - see the link:LICENSE[LICENSE] file for details.

== Acknowledgments

* link:https://github.com/ai/nanoid[Nano ID] - Original JavaScript implementation
* link:https://github.com/aventrix/jnanoid[jnanoid] - Java port
* link:https://neo4j.com[Neo4j] - Graph database platform

---

*Made with ‚ù§Ô∏è for the Neo4j community*
